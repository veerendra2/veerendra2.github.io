<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Wireguard VPN and BitTorrent on Docker Swarm (Part 1) | Veerendra's Blog</title><meta name=keywords content="wireguard,vpn,docker-swarm,bittorent,docker,traefik,socks5,dante-server,proxy,networking"><meta name=description content="Introduction One of the services I always wanted to have on my raspberry pi home server is VPN and BitTorrent, which basically, route all BitTorrent traffic through a VPN container. Then I saw Wolfgang&rsquo;s &ldquo;Set Up Your Own Wireguard VPN Server with 2FA in 5 Minutes!&rdquo; on Youtube, which inspired me to set up my own VPN server. I quickly created an instance on Oracle Cloud and ran the ansible playbook to deploy the wireguard VPN."><meta name=author content="Veerendra K"><link rel=canonical href=https://veerendra2.github.io/wireguard-qbittorrent-docker-swarm-1/><link crossorigin=anonymous href=/assets/css/stylesheet.min.1e44d58192cbf6d7a4eb649bc43dbc3d4cc432677e5d8adc69b08c34cbe461ac.css integrity="sha256-HkTVgZLL9tek62SbxD28PUzEMmd+XYrcabCMNMvkYaw=" rel="preload stylesheet" as=style><link rel=icon href=https://veerendra2.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://veerendra2.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://veerendra2.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://veerendra2.github.io/apple-touch-icon.png><link rel=mask-icon href=https://veerendra2.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.110.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5486872721715518" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-112970252-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Wireguard VPN and BitTorrent on Docker Swarm (Part 1)"><meta property="og:description" content="Introduction One of the services I always wanted to have on my raspberry pi home server is VPN and BitTorrent, which basically, route all BitTorrent traffic through a VPN container. Then I saw Wolfgang&rsquo;s &ldquo;Set Up Your Own Wireguard VPN Server with 2FA in 5 Minutes!&rdquo; on Youtube, which inspired me to set up my own VPN server. I quickly created an instance on Oracle Cloud and ran the ansible playbook to deploy the wireguard VPN."><meta property="og:type" content="article"><meta property="og:url" content="https://veerendra2.github.io/wireguard-qbittorrent-docker-swarm-1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-01T00:00:00+00:00"><meta property="article:modified_time" content="2023-04-01T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Wireguard VPN and BitTorrent on Docker Swarm (Part 1)"><meta name=twitter:description content="Introduction One of the services I always wanted to have on my raspberry pi home server is VPN and BitTorrent, which basically, route all BitTorrent traffic through a VPN container. Then I saw Wolfgang&rsquo;s &ldquo;Set Up Your Own Wireguard VPN Server with 2FA in 5 Minutes!&rdquo; on Youtube, which inspired me to set up my own VPN server. I quickly created an instance on Oracle Cloud and ran the ansible playbook to deploy the wireguard VPN."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://veerendra2.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Home Server Setup","item":"https://veerendra2.github.io/posts/home-server-setup/"},{"@type":"ListItem","position":4,"name":"Wireguard VPN and BitTorrent on Docker Swarm (Part 1)","item":"https://veerendra2.github.io/wireguard-qbittorrent-docker-swarm-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Wireguard VPN and BitTorrent on Docker Swarm (Part 1)","name":"Wireguard VPN and BitTorrent on Docker Swarm (Part 1)","description":"Introduction One of the services I always wanted to have on my raspberry pi home server is VPN and BitTorrent, which basically, route all BitTorrent traffic through a VPN container. Then I saw Wolfgang\u0026rsquo;s \u0026ldquo;Set Up Your Own Wireguard VPN Server with 2FA in 5 Minutes!\u0026rdquo; on Youtube, which inspired me to set up my own VPN server. I quickly created an instance on Oracle Cloud and ran the ansible playbook to deploy the wireguard VPN.","keywords":["wireguard","vpn","docker-swarm","bittorent","docker","traefik","socks5","dante-server","proxy","networking"],"articleBody":"Introduction One of the services I always wanted to have on my raspberry pi home server is VPN and BitTorrent, which basically, route all BitTorrent traffic through a VPN container. Then I saw Wolfgangâ€™s â€œSet Up Your Own Wireguard VPN Server with 2FA in 5 Minutes!â€ on Youtube, which inspired me to set up my own VPN server. I quickly created an instance on Oracle Cloud and ran the ansible playbook to deploy the wireguard VPN. After I tested a few months on Mobile and PC, Iâ€™m comfortable setting up server and client. So, I decided to use the Wireguard in my raspberrypi-homeserver project.\nBut why BitTorrent with VPN? BitTorrent does not, on its own, offer its users anonymity. One can usually see the IP addresses of all peers in a swarm in oneâ€™s own client or firewall program. This may expose users with insecure systems to attacks.\nhttps://en.wikipedia.org/wiki/BitTorrent#Anonymity\nFor better anonymity, I decided to use VPN for BitTorrent and to download my favourite linux distros\nGoal The goal of this blog is a how-to guide on routing BitTorrent client traffic through Wireguard VPN on the Docker swarm cluster.\nNOTE âœ‹: The scope of the post is to set up qBittorent and Wireguard VPN clients only, DOES NOT include wireguard server setup. I would recommend checking Set Up Your Own Wireguard VPN Server with 2FA in 5 Minutes! to know how to set up Wireguard VPN server.\nThis blog post is divided into 2 parts\nâœ’ï¸ Part 1 covers Intro Challenges on docker swarm Architecture Deployment âœ’ï¸ Part 2 covers Testing the stack qBittorrent proxy configuration and testing Kill switch configuration Conclusion By the way, recently I migrated my raspberry pi home server docker-compose setup to docker swarm services, maybe that is for another blog on what were the challenges. But for now, letâ€™s see how to route BitTorrent traffic through the Wireguard VPN docker container.\nSource code available in my GitHub repo: https://github.com/veerendra2/raspberrypi-homeserver/tree/main/services/torrent\nChallenges on docker swarm There are some challenges I faced while deploying the BitTorrent client using wireguard.\nContainer linking ğŸ‘‰ https://docs.docker.com/network/links/\nUnlike docker-compose container linking, docker swarm doesnâ€™t allow container linking.\nIt would have been a very easy and secure link between qBittorent and wireguard client\nğŸŸ¢ Github open issue: https://github.com/moby/moby/issues/33055\nAlternate options 1. ip routes and iptable rules Create some iptable rules to make Wireguard container a NAT router and set default route to Wireguard in qBittorrent container. In docker-compose, assign ip address to the container like below\n... networks: dhcp-relay-net: ipv4_address: '172.31.0.10' front-tier: {} ... then I can create a shell script to create iptables rules and routes, but in docker swarm, it is not possible to assign ip to a container in the stack\nğŸŸ¢ Github open issue: https://github.com/moby/moby/issues/31860\n2. Go back to docker-compose Since docker-compose has container linking, one option is to go back to the docker-compose setup for this stack. I use traefik for reverse proxy with sub path. After I googled, traefik canâ€™t support both docker standalone(docker-composer) and docker swarm at the same time.\nğŸŸ¢ Github open issue: https://github.com/traefik/traefik/issues/6063\n3. Monolithic Docker image Use all-in-one docker image which has qBittorrent and Wireguard. This options looks good, but the down side of the options is typical monolithic approach issues\nIf I want to add or remove services like radarr, jackett, etc I have re-build and have no flexibility Have to rebuild the image if there is a version change 4. SOCKS5 proxy with internal network The final and decent approach is to make sure qBittorrent container does NOT directly connect to the Internet and connect to Wireguard container via the internal network i.e. internal: true to access the Internet with SOCKS5 proxy protocol (As you can see in below diagram)\nâ”Œ â”‚ â”” â”€ q â”€ â”€ B â”€ â”€ i â”€ â”€ t â”€ â”€ t â”€ â”€ o â”€ â”€ r â”€ â”€ r â”€ â”€ e â”€ â”€ n â”€ â”€ t â”€ â” â”œ â”˜ S â”€ O â”€ C â”€ K â”€ S â”€ 5 â”€ â”€ P â”€ r â”€ o â”€ x â”€ y â–º â”Œ â”‚ â”‚ â”” â”€ W â”€ â”€ i C â”€ â”€ r l â”€ â”€ e i â”€ â”€ g e â”€ â”€ u n â”€ â”€ a t â”€ â”€ r â”€ â”€ d â”€ â” â”‚ â”œ â”˜ â”€ â”€ â”€ â”€ â”€ â–º â”Œ â”‚ â”” â”€ I â”€ â”€ N â”€ â”€ T â”€ â”€ E â”€ â”€ R â”€ â”€ N â”€ â”€ E â”€ â”€ T â”€ â” â”‚ â”˜ After googling, I found dante-server â€œA free SOCKS serverâ€. I opened github issue, feature request #250 in linuxserver/docker-wireguard to add dante-server in Wireguard image. But, it was rejected, because, it can be done in either customizing containers or as a docker mods.\nSo, I customized the linuxserverâ€™s Wireguard container by installing and starting the dante-server while bootstrapping the Wireguard container, as you can next sections\nArchitecture Finally, here is the architecture with traefik reverse proxy\nFrom the above diagram, the traefik_private overlay network is configured with internal: true, which mean there is no external connectivity, but traefik can set up the reverse proxy to qBittorrent, so that I can access. Wireguard is connected to traefik_private and internal overlay network with internal: false i.e. there is external connectivity. So, the idea here is run a SOCKS5 server on Wireguard and configure qBittorrent proxy.\nqBittorent can connect Wireguard, but not directly to the Internet Wireguard is accessible to qBittorent and connected to the Internet too In a nutshell, qBittorent can reach the Internet via Wiregaurd SOCKS5 proxyâ€¦ ta-da!ğŸ‰\nDeploy ğŸ“‚ You can browse source code in my GitHub repo: https://github.com/veerendra2/raspberrypi-homeserver\nI created a simple ansible playbook to deploy all services on my raspberry pi. But for the sake of the blog, I will show you how to deploy manually with traefik reverse proxy\nTraefik reverse proxy Since Iâ€™m using traefik reverse proxy in my raspberry pi. Iâ€™m showing how to deploy it, if you have a different reverse proxy(like Nginx), skip this step. But, make sure you make it compatible with the above architecture\n$ git clone https://github.com/veerendra2/raspberrypi-homeserver.git $ cd services/traefikv2 # Create traefik_private and traefik_public network $ docker stack deploy -c traefik.yml traefik $ docker network ls NETWORK ID NAME DRIVER SCOPE 9ov3x46i6ci0 traefik_private overlay swarm ydbzvtoc1xvg traefik_public overlay swarm # Deploy traefik reverse proxy $ docker stack deploy -c docker-stack.yml traefikv2 $ $ docker stack ls NAME SERVICES traefik 1 traefikv2 1 Wireguard VPN and qBittorrent ğŸ“‚ https://github.com/veerendra2/raspberrypi-homeserver/tree/main/services/torrent\nMake sure you have Wireguard VPN server up and running and get wg0.conf\nHere is my directory structure(Ignore jackett and radarr for now)\n$ cd services/torrent $ tree . . â”œâ”€â”€ README.md â”œâ”€â”€ docker-stack.yml â”œâ”€â”€ ip-test.sh â”œâ”€â”€ jackett â”‚ â””â”€â”€ ServerConfig.json â”œâ”€â”€ qbittorrent â”‚ â””â”€â”€ qBittorrent.conf â”œâ”€â”€ radarr â”‚ â””â”€â”€ config.xml â””â”€â”€ wireguard â”œâ”€â”€ dante-server â”‚ â”œâ”€â”€ danted.conf â”‚ â”œâ”€â”€ install.sh â”‚ â””â”€â”€ run.sh â””â”€â”€ wg0.conf 5 directories, 10 files The dante-server installation and bootstrapping is straight forward, you just create a scripts like below\n$ cd services/torrent $ tree wireguard/dante-server/ wireguard/dante-server/ â”œâ”€â”€ danted.conf \u003c---- danted configuration â”œâ”€â”€ install.sh \u003c----- Install dante-server â””â”€â”€ run.sh \u003c--------- Start the danted daemon 0 directories, 3 files And mount these files in wireguard container like below(docker-stack.yml#L38-#L43)\n... volumes: - ./wireguard/dante-server/danted.conf:/etc/danted.conf - ./wireguard/dante-server/install.sh:/custom-cont-init.d/install.sh:ro - ./wireguard/dante-server/run.sh:/custom-services.d/run.sh:ro ... Thatâ€™s it! the scripts will install and bootstrap dante-server in Wireguard container\n$ cd services/torrent # Deploy stack $ docker stack deploy -c docker-stack.yml torrent $ docker stack ls NAME SERVICES torrent 4 traefik 1 traefikv2 1 Thatâ€™s it for now! Next, in part 2, we will see how to test connections and configure clients\n","wordCount":"1272","inLanguage":"en","datePublished":"2023-04-01T00:00:00Z","dateModified":"2023-04-01T00:00:00Z","author":{"@type":"Person","name":"Veerendra K"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://veerendra2.github.io/wireguard-qbittorrent-docker-swarm-1/"},"publisher":{"@type":"Organization","name":"Veerendra's Blog","logo":{"@type":"ImageObject","url":"https://veerendra2.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://veerendra2.github.io accesskey=h title="Veerendra's Blog (Alt + H)">Veerendra's Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://veerendra2.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://veerendra2.github.io/posts/nuggets/ title=Nuggets><span>Nuggets</span></a></li><li><a href=https://veerendra2.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://veerendra2.github.io>Home</a>&nbsp;Â»&nbsp;<a href=https://veerendra2.github.io/posts/>Posts</a>&nbsp;Â»&nbsp;<a href=https://veerendra2.github.io/posts/home-server-setup/>Home Server Setup</a></div><h1 class=post-title>Wireguard VPN and BitTorrent on Docker Swarm (Part 1)</h1><div class=post-meta><span title='2023-04-01 00:00:00 +0000 UTC'>April 1, 2023</span>&nbsp;Â·&nbsp;6 min&nbsp;Â·&nbsp;Veerendra K&nbsp;|&nbsp;<a href="https://github.com/veerendra2/veerendra2.github.io/issues/new?assignees=veerendra2&labels=bug&template=suggest-changes.md&title=%5BCHANGE%5D" rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a><ul><li><a href=#but-why-bittorrent-with-vpn aria-label="But why BitTorrent with VPN?">But why BitTorrent with VPN?</a></li><li><a href=#goal aria-label=Goal>Goal</a></li></ul></li><li><a href=#challenges-on-docker-swarm aria-label="Challenges on docker swarm">Challenges on docker swarm</a><ul><li><a href=#container-linking aria-label="Container linking">Container linking</a></li><li><a href=#alternate-options aria-label="Alternate options">Alternate options</a><ul><li><a href=#1-ip-routes-and-iptable-rules aria-label="1. ip routes and iptable rules">1. <code>ip routes</code> and <code>iptable</code> rules</a></li><li><a href=#2-go-back-to-docker-compose aria-label="2. Go back to docker-compose">2. Go back to <code>docker-compose</code></a></li><li><a href=#3-monolithic-docker-image aria-label="3. Monolithic Docker image">3. Monolithic Docker image</a></li><li><a href=#4-socks5-proxy-with-internal-network aria-label="4. SOCKS5 proxy with internal network">4. <code>SOCKS5</code> proxy with <code>internal</code> network</a></li></ul></li></ul></li><li><a href=#architecture aria-label=Architecture>Architecture</a></li><li><a href=#deploy aria-label=Deploy>Deploy</a><ul><li><a href=#traefik-reverse-proxy aria-label="Traefik reverse proxy">Traefik reverse proxy</a></li><li><a href=#wireguard-vpn-and-qbittorrent aria-label="Wireguard VPN and qBittorrent">Wireguard VPN and qBittorrent</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h1><p>One of the services I always wanted to have on my <a href=https://github.com/veerendra2/raspberrypi-homeserver>raspberry pi home server</a> is VPN and BitTorrent, which basically, route all BitTorrent traffic through a VPN container. Then I saw Wolfgang&rsquo;s <a href="https://www.youtube.com/watch?v=SMF301vQqJo">&ldquo;Set Up Your Own Wireguard VPN Server with 2FA in 5 Minutes!&rdquo;</a> on Youtube, which inspired me to set up my own VPN server. I quickly created an instance on Oracle Cloud and ran the <a href=https://github.com/notthebee/ansible-easy-vpn>ansible playbook</a> to deploy the wireguard VPN. After I tested a few months on Mobile and PC, I&rsquo;m comfortable setting up server and client. So, I decided to use the Wireguard in my <a href=https://github.com/veerendra2/raspberrypi-homeserver>raspberrypi-homeserver</a> project.</p><p><img loading=lazy src=/static_content/images/wireguard-qbittorrent.png alt=blog-14-1></p><h2 id=but-why-bittorrent-with-vpn>But why BitTorrent with VPN?<a hidden class=anchor aria-hidden=true href=#but-why-bittorrent-with-vpn>#</a></h2><blockquote><p>BitTorrent does not, on its own, offer its users anonymity. One can usually see the IP addresses of all peers in a swarm in one&rsquo;s own client or firewall program. This may expose users with insecure systems to attacks.</p><p><a href=https://en.wikipedia.org/wiki/BitTorrent#Anonymity>https://en.wikipedia.org/wiki/BitTorrent#Anonymity</a></p></blockquote><p>For better anonymity, I decided to use VPN for BitTorrent and to download my favourite <a href="https://distrowatch.com/dwres.php?resource=bittorrent">linux distros</a></p><h2 id=goal>Goal<a hidden class=anchor aria-hidden=true href=#goal>#</a></h2><p>The goal of this blog is a how-to guide on routing BitTorrent client traffic through Wireguard VPN on the Docker swarm cluster.</p><p><img loading=lazy src=/static_content/images/blog-14-1.png alt=blog-14-1></p><p><strong>NOTE âœ‹:</strong> The scope of the post is to set up qBittorent and Wireguard VPN clients only, <strong>DOES NOT</strong> include wireguard server setup. I would recommend checking <a href="https://www.youtube.com/watch?v=SMF301vQqJo">Set Up Your Own Wireguard VPN Server with 2FA in 5 Minutes!</a> to know how to set up Wireguard VPN server.</p><p>This blog post is divided into 2 parts</p><ul><li>âœ’ï¸ <a href=https://veerendra2.github.io/wireguard-qbittorrent-docker-swarm-1/ title="Part 1">Part 1</a> covers<ul><li>Intro</li><li>Challenges on docker swarm</li><li>Architecture</li><li>Deployment</li></ul></li><li>âœ’ï¸ <a href=https://veerendra2.github.io/wireguard-qbittorrent-docker-swarm-2/ title="Part 2">Part 2</a> covers<ul><li>Testing the stack</li><li>qBittorrent proxy configuration and testing</li><li>Kill switch configuration</li><li>Conclusion</li></ul></li></ul><p>By the way, recently I migrated my raspberry pi home server <code>docker-compose</code> setup to <code>docker swarm services</code>, maybe that is for another blog on what were the challenges. But for now, let&rsquo;s see how to route BitTorrent traffic through the Wireguard VPN docker container.</p><p>Source code available in my GitHub repo: <a href=https://github.com/veerendra2/raspberrypi-homeserver/tree/main/services/torrent>https://github.com/veerendra2/raspberrypi-homeserver/tree/main/services/torrent</a></p><h1 id=challenges-on-docker-swarm>Challenges on docker swarm<a hidden class=anchor aria-hidden=true href=#challenges-on-docker-swarm>#</a></h1><p>There are some challenges I faced while deploying the BitTorrent client using wireguard.</p><h2 id=container-linking>Container linking<a hidden class=anchor aria-hidden=true href=#container-linking>#</a></h2><blockquote><p>ğŸ‘‰ <a href=https://docs.docker.com/network/links/>https://docs.docker.com/network/links/</a></p></blockquote><p>Unlike <code>docker-compose</code> <a href=https://docs.docker.com/compose/networking/#link-containers>container linking</a>, docker swarm doesn&rsquo;t allow container linking.</p><p>It would have been a very easy and secure link between qBittorent and wireguard client</p><p>ğŸŸ¢ Github open issue: <a href=https://github.com/moby/moby/issues/33055>https://github.com/moby/moby/issues/33055</a></p><h2 id=alternate-options>Alternate options<a hidden class=anchor aria-hidden=true href=#alternate-options>#</a></h2><h3 id=1-ip-routes-and-iptable-rules>1. <code>ip routes</code> and <code>iptable</code> rules<a hidden class=anchor aria-hidden=true href=#1-ip-routes-and-iptable-rules>#</a></h3><p>Create some iptable rules to make Wireguard container a NAT router and set default route to Wireguard in qBittorrent container. In <code>docker-compose</code>, assign ip address to the container like below</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>dhcp-relay-net</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ipv4_address</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;172.31.0.10&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>front-tier</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span></code></pre></div><p>then I can create a shell script to create iptables rules and routes, but in docker swarm, it is not possible to assign ip to a container in the stack</p><p>ğŸŸ¢ Github open issue: <a href=https://github.com/moby/moby/issues/31860>https://github.com/moby/moby/issues/31860</a></p><h3 id=2-go-back-to-docker-compose>2. Go back to <code>docker-compose</code><a hidden class=anchor aria-hidden=true href=#2-go-back-to-docker-compose>#</a></h3><p>Since <code>docker-compose</code> has container linking, one option is to go back to the <code>docker-compose</code> setup for this stack. I use <code>traefik</code> for reverse proxy with sub path. After I googled, <code>traefik</code> can&rsquo;t support both docker standalone(<code>docker-composer</code>) and docker swarm at the same time.</p><p>ğŸŸ¢ Github open issue: <a href=https://github.com/traefik/traefik/issues/6063>https://github.com/traefik/traefik/issues/6063</a></p><h3 id=3-monolithic-docker-image>3. Monolithic Docker image<a hidden class=anchor aria-hidden=true href=#3-monolithic-docker-image>#</a></h3><p>Use all-in-one docker image which has qBittorrent and Wireguard. This options looks good, but the down side of the options is typical monolithic approach issues</p><ul><li>If I want to add or remove services like <code>radarr</code>, <code>jackett</code>, etc I have re-build and have no flexibility</li><li>Have to rebuild the image if there is a version change</li></ul><h3 id=4-socks5-proxy-with-internal-network>4. <code>SOCKS5</code> proxy with <code>internal</code> network<a hidden class=anchor aria-hidden=true href=#4-socks5-proxy-with-internal-network>#</a></h3><p>The final and decent approach is to make sure qBittorrent container does NOT directly connect to the Internet and connect to Wireguard container via the internal network i.e. <a href=https://docs.docker.com/engine/reference/commandline/network_create/#internal><code>internal: true</code></a> to access the Internet with <code>SOCKS5</code> proxy protocol (As you can see in below diagram)</p><div class="goat svg-container"><svg xmlns="http://www.w3.org/2000/svg" font-family="Menlo,Lucida Console,monospace" viewBox="0 0 424 73"><g transform="translate(8,16)"><text text-anchor="middle" x="0" y="20" fill="currentcolor" style="font-size:1em">â”Œ</text><text text-anchor="middle" x="0" y="36" fill="currentcolor" style="font-size:1em">â”‚</text><text text-anchor="middle" x="0" y="52" fill="currentcolor" style="font-size:1em">â””</text><text text-anchor="middle" x="8" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="8" y="36" fill="currentcolor" style="font-size:1em">q</text><text text-anchor="middle" x="8" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="16" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="16" y="36" fill="currentcolor" style="font-size:1em">B</text><text text-anchor="middle" x="16" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="24" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="24" y="36" fill="currentcolor" style="font-size:1em">i</text><text text-anchor="middle" x="24" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="32" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="32" y="36" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="32" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="40" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="40" y="36" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="40" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="48" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="48" y="36" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="48" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="56" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="56" y="36" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="56" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="64" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="64" y="36" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="64" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="72" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="72" y="36" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="72" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="80" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="80" y="36" fill="currentcolor" style="font-size:1em">n</text><text text-anchor="middle" x="80" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="88" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="88" y="36" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="88" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="96" y="20" fill="currentcolor" style="font-size:1em">â”</text><text text-anchor="middle" x="96" y="36" fill="currentcolor" style="font-size:1em">â”œ</text><text text-anchor="middle" x="96" y="52" fill="currentcolor" style="font-size:1em">â”˜</text><text text-anchor="middle" x="104" y="20" fill="currentcolor" style="font-size:1em">S</text><text text-anchor="middle" x="104" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="112" y="20" fill="currentcolor" style="font-size:1em">O</text><text text-anchor="middle" x="112" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="120" y="20" fill="currentcolor" style="font-size:1em">C</text><text text-anchor="middle" x="120" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="128" y="20" fill="currentcolor" style="font-size:1em">K</text><text text-anchor="middle" x="128" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="136" y="20" fill="currentcolor" style="font-size:1em">S</text><text text-anchor="middle" x="136" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="144" y="20" fill="currentcolor" style="font-size:1em">5</text><text text-anchor="middle" x="144" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="152" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="160" y="20" fill="currentcolor" style="font-size:1em">P</text><text text-anchor="middle" x="160" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="168" y="20" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="168" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="176" y="20" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="176" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="184" y="20" fill="currentcolor" style="font-size:1em">x</text><text text-anchor="middle" x="184" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="192" y="20" fill="currentcolor" style="font-size:1em">y</text><text text-anchor="middle" x="192" y="36" fill="currentcolor" style="font-size:1em">â–º</text><text text-anchor="middle" x="200" y="4" fill="currentcolor" style="font-size:1em">â”Œ</text><text text-anchor="middle" x="200" y="20" fill="currentcolor" style="font-size:1em">â”‚</text><text text-anchor="middle" x="200" y="36" fill="currentcolor" style="font-size:1em">â”‚</text><text text-anchor="middle" x="200" y="52" fill="currentcolor" style="font-size:1em">â””</text><text text-anchor="middle" x="208" y="4" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="208" y="20" fill="currentcolor" style="font-size:1em">W</text><text text-anchor="middle" x="208" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="216" y="4" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="216" y="20" fill="currentcolor" style="font-size:1em">i</text><text text-anchor="middle" x="216" y="36" fill="currentcolor" style="font-size:1em">C</text><text text-anchor="middle" x="216" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="224" y="4" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="224" y="20" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="224" y="36" fill="currentcolor" style="font-size:1em">l</text><text text-anchor="middle" x="224" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="232" y="4" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="232" y="20" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="232" y="36" fill="currentcolor" style="font-size:1em">i</text><text text-anchor="middle" x="232" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="240" y="4" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="240" y="20" fill="currentcolor" style="font-size:1em">g</text><text text-anchor="middle" x="240" y="36" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="240" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="248" y="4" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="248" y="20" fill="currentcolor" style="font-size:1em">u</text><text text-anchor="middle" x="248" y="36" fill="currentcolor" style="font-size:1em">n</text><text text-anchor="middle" x="248" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="256" y="4" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="256" y="20" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="256" y="36" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="256" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="264" y="4" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="264" y="20" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="264" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="272" y="4" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="272" y="20" fill="currentcolor" style="font-size:1em">d</text><text text-anchor="middle" x="272" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="280" y="4" fill="currentcolor" style="font-size:1em">â”</text><text text-anchor="middle" x="280" y="20" fill="currentcolor" style="font-size:1em">â”‚</text><text text-anchor="middle" x="280" y="36" fill="currentcolor" style="font-size:1em">â”œ</text><text text-anchor="middle" x="280" y="52" fill="currentcolor" style="font-size:1em">â”˜</text><text text-anchor="middle" x="288" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="296" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="304" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="312" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="320" y="36" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="328" y="36" fill="currentcolor" style="font-size:1em">â–º</text><text text-anchor="middle" x="336" y="20" fill="currentcolor" style="font-size:1em">â”Œ</text><text text-anchor="middle" x="336" y="36" fill="currentcolor" style="font-size:1em">â”‚</text><text text-anchor="middle" x="336" y="52" fill="currentcolor" style="font-size:1em">â””</text><text text-anchor="middle" x="344" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="344" y="36" fill="currentcolor" style="font-size:1em">I</text><text text-anchor="middle" x="344" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="352" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="352" y="36" fill="currentcolor" style="font-size:1em">N</text><text text-anchor="middle" x="352" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="360" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="360" y="36" fill="currentcolor" style="font-size:1em">T</text><text text-anchor="middle" x="360" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="368" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="368" y="36" fill="currentcolor" style="font-size:1em">E</text><text text-anchor="middle" x="368" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="376" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="376" y="36" fill="currentcolor" style="font-size:1em">R</text><text text-anchor="middle" x="376" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="384" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="384" y="36" fill="currentcolor" style="font-size:1em">N</text><text text-anchor="middle" x="384" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="392" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="392" y="36" fill="currentcolor" style="font-size:1em">E</text><text text-anchor="middle" x="392" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="400" y="20" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="400" y="36" fill="currentcolor" style="font-size:1em">T</text><text text-anchor="middle" x="400" y="52" fill="currentcolor" style="font-size:1em">â”€</text><text text-anchor="middle" x="408" y="20" fill="currentcolor" style="font-size:1em">â”</text><text text-anchor="middle" x="408" y="36" fill="currentcolor" style="font-size:1em">â”‚</text><text text-anchor="middle" x="408" y="52" fill="currentcolor" style="font-size:1em">â”˜</text></g></svg></div><p>After googling, I found <a href=https://www.inet.no/dante/><code>dante-server</code></a> &ldquo;A free SOCKS server&rdquo;. I opened github issue, feature request <a href=https://github.com/linuxserver/docker-wireguard/issues/250>#250</a> in <a href=https://github.com/linuxserver/docker-wireguard>linuxserver/docker-wireguard</a> to add <code>dante-server</code> in Wireguard image. But, it was rejected, because, it can be done in either <a href=https://www.linuxserver.io/blog/2019-09-14-customizing-our-containers>customizing containers</a> or as a <a href=https://github.com/linuxserver/docker-mods/>docker mods</a>.</p><p>So, I customized the linuxserver&rsquo;s Wireguard container by installing and starting the <code>dante-server</code> while bootstrapping the Wireguard container, as you can next sections</p><h1 id=architecture>Architecture<a hidden class=anchor aria-hidden=true href=#architecture>#</a></h1><p>Finally, here is the architecture with <code>traefik</code> reverse proxy</p><p><img loading=lazy src=/static_content/images/blog-14-2.png alt=blog-14-2></p><p>From the above diagram, the <code>traefik_private</code> overlay network is configured with <a href=https://docs.docker.com/engine/reference/commandline/network_create/#internal><code>internal: true</code></a>, which mean there is no external connectivity, but <code>traefik</code> can set up the reverse proxy to <code>qBittorrent</code>, so that I can access. Wireguard is connected to <code>traefik_private</code> and <code>internal</code> overlay network with <code>internal: false</code> i.e. there is external connectivity. So, the idea here is run a <code>SOCKS5</code> server on Wireguard and configure qBittorrent proxy.</p><ul><li>qBittorent can connect Wireguard, but not directly to the Internet</li><li>Wireguard is accessible to qBittorent and connected to the Internet too</li></ul><p>In a nutshell, qBittorent can reach the Internet via Wiregaurd <code>SOCKS5</code> proxy&mldr; ta-da!ğŸ‰</p><h1 id=deploy>Deploy<a hidden class=anchor aria-hidden=true href=#deploy>#</a></h1><blockquote><p>ğŸ“‚ You can browse source code in my GitHub repo: <a href=https://github.com/veerendra2/raspberrypi-homeserver>https://github.com/veerendra2/raspberrypi-homeserver</a></p></blockquote><p>I created a simple ansible playbook to deploy all services on my raspberry pi. But for the sake of the blog, I will show you how to deploy manually with <code>traefik</code> reverse proxy</p><h2 id=traefik-reverse-proxy>Traefik reverse proxy<a hidden class=anchor aria-hidden=true href=#traefik-reverse-proxy>#</a></h2><p>Since I&rsquo;m using traefik reverse proxy in my raspberry pi. I&rsquo;m showing how to deploy it, if you have a different reverse proxy(like Nginx), skip this step. But, make sure you make it compatible with the above architecture</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ git clone https://github.com/veerendra2/raspberrypi-homeserver.git
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> services/traefikv2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Create traefik_private and traefik_public network</span>
</span></span><span class=line><span class=cl>$ docker stack deploy -c traefik.yml traefik
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker network ls
</span></span><span class=line><span class=cl>NETWORK ID     NAME                  DRIVER    SCOPE
</span></span><span class=line><span class=cl>9ov3x46i6ci0   traefik_private       overlay   swarm
</span></span><span class=line><span class=cl>ydbzvtoc1xvg   traefik_public        overlay   swarm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Deploy traefik reverse proxy</span>
</span></span><span class=line><span class=cl>$ docker stack deploy -c docker-stack.yml traefikv2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ $ docker stack ls
</span></span><span class=line><span class=cl>NAME          SERVICES
</span></span><span class=line><span class=cl>traefik       <span class=m>1</span>
</span></span><span class=line><span class=cl>traefikv2     <span class=m>1</span>
</span></span></code></pre></div><h2 id=wireguard-vpn-and-qbittorrent>Wireguard VPN and qBittorrent<a hidden class=anchor aria-hidden=true href=#wireguard-vpn-and-qbittorrent>#</a></h2><blockquote><p>ğŸ“‚ <a href=https://github.com/veerendra2/raspberrypi-homeserver/tree/main/services/torrent>https://github.com/veerendra2/raspberrypi-homeserver/tree/main/services/torrent</a></p></blockquote><p>Make sure you have Wireguard VPN server up and running and get <code>wg0.conf</code></p><p>Here is my directory structure(Ignore <code>jackett</code> and <code>radarr</code> for now)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> services/torrent
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ tree .
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>â”œâ”€â”€ README.md
</span></span><span class=line><span class=cl>â”œâ”€â”€ docker-stack.yml
</span></span><span class=line><span class=cl>â”œâ”€â”€ ip-test.sh
</span></span><span class=line><span class=cl>â”œâ”€â”€ jackett
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ ServerConfig.json
</span></span><span class=line><span class=cl>â”œâ”€â”€ qbittorrent
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ qBittorrent.conf
</span></span><span class=line><span class=cl>â”œâ”€â”€ radarr
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ config.xml
</span></span><span class=line><span class=cl>â””â”€â”€ wireguard
</span></span><span class=line><span class=cl>    â”œâ”€â”€ dante-server
</span></span><span class=line><span class=cl>    â”‚   â”œâ”€â”€ danted.conf
</span></span><span class=line><span class=cl>    â”‚   â”œâ”€â”€ install.sh
</span></span><span class=line><span class=cl>    â”‚   â””â”€â”€ run.sh
</span></span><span class=line><span class=cl>    â””â”€â”€ wg0.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>5</span> directories, <span class=m>10</span> files
</span></span></code></pre></div><p>The <code>dante-server</code> installation and bootstrapping is straight forward, you just create a scripts like below</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> services/torrent
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ tree wireguard/dante-server/
</span></span><span class=line><span class=cl>wireguard/dante-server/
</span></span><span class=line><span class=cl>â”œâ”€â”€ danted.conf &lt;---- danted configuration
</span></span><span class=line><span class=cl>â”œâ”€â”€ install.sh &lt;----- Install dante-server
</span></span><span class=line><span class=cl>â””â”€â”€ run.sh &lt;--------- Start the danted daemon
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>0</span> directories, <span class=m>3</span> files
</span></span></code></pre></div><p>And mount these files in wireguard container like below(<a href=https://github.com/veerendra2/raspberrypi-homeserver/blob/main/services/torrent/docker-stack.yml#L38-#L43>docker-stack.yml#L38-#L43</a>)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./wireguard/dante-server/danted.conf:/etc/danted.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./wireguard/dante-server/install.sh:/custom-cont-init.d/install.sh:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./wireguard/dante-server/run.sh:/custom-services.d/run.sh:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span></code></pre></div><p>That&rsquo;s it! the scripts will install and bootstrap <code>dante-server</code> in Wireguard container</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> services/torrent
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Deploy stack</span>
</span></span><span class=line><span class=cl>$ docker stack deploy -c docker-stack.yml torrent
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker stack ls
</span></span><span class=line><span class=cl>NAME          SERVICES
</span></span><span class=line><span class=cl>torrent       <span class=m>4</span>
</span></span><span class=line><span class=cl>traefik       <span class=m>1</span>
</span></span><span class=line><span class=cl>traefikv2     <span class=m>1</span>
</span></span></code></pre></div><br><br><p>That&rsquo;s it for now! Next, in <a href=https://veerendra2.github.io/wireguard-qbittorrent-docker-swarm-2/ title="part 2">part 2</a>, we will see how to test connections and configure clients</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://veerendra2.github.io/tags/wireguard/>wireguard</a></li><li><a href=https://veerendra2.github.io/tags/vpn/>vpn</a></li><li><a href=https://veerendra2.github.io/tags/docker-swarm/>docker-swarm</a></li><li><a href=https://veerendra2.github.io/tags/bittorent/>bittorent</a></li><li><a href=https://veerendra2.github.io/tags/docker/>docker</a></li><li><a href=https://veerendra2.github.io/tags/traefik/>traefik</a></li><li><a href=https://veerendra2.github.io/tags/socks5/>socks5</a></li><li><a href=https://veerendra2.github.io/tags/dante-server/>dante-server</a></li><li><a href=https://veerendra2.github.io/tags/proxy/>proxy</a></li><li><a href=https://veerendra2.github.io/tags/networking/>networking</a></li></ul><nav class=paginav><a class=prev href=https://veerendra2.github.io/traefik-https/><span class=title>Â« Prev Page</span><br><span>Traefik HTTPS Config with DuckDNS for Local Homeserver</span></a>
<a class=next href=https://veerendra2.github.io/wireguard-qbittorrent-docker-swarm-2/><span class=title>Next Page Â»</span><br><span>Wireguard VPN and BitTorrent on Docker Swarm (Part 2)</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Wireguard VPN and BitTorrent on Docker Swarm (Part 1) on twitter" href="https://twitter.com/intent/tweet/?text=Wireguard%20VPN%20and%20BitTorrent%20on%20Docker%20Swarm%20%28Part%201%29&url=https%3a%2f%2fveerendra2.github.io%2fwireguard-qbittorrent-docker-swarm-1%2f&hashtags=wireguard%2cvpn%2cdocker-swarm%2cbittorent%2cdocker%2ctraefik%2csocks5%2cdante-server%2cproxy%2cnetworking"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Wireguard VPN and BitTorrent on Docker Swarm (Part 1) on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fveerendra2.github.io%2fwireguard-qbittorrent-docker-swarm-1%2f&title=Wireguard%20VPN%20and%20BitTorrent%20on%20Docker%20Swarm%20%28Part%201%29&summary=Wireguard%20VPN%20and%20BitTorrent%20on%20Docker%20Swarm%20%28Part%201%29&source=https%3a%2f%2fveerendra2.github.io%2fwireguard-qbittorrent-docker-swarm-1%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Wireguard VPN and BitTorrent on Docker Swarm (Part 1) on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fveerendra2.github.io%2fwireguard-qbittorrent-docker-swarm-1%2f&title=Wireguard%20VPN%20and%20BitTorrent%20on%20Docker%20Swarm%20%28Part%201%29"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Wireguard VPN and BitTorrent on Docker Swarm (Part 1) on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fveerendra2.github.io%2fwireguard-qbittorrent-docker-swarm-1%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Wireguard VPN and BitTorrent on Docker Swarm (Part 1) on whatsapp" href="https://api.whatsapp.com/send?text=Wireguard%20VPN%20and%20BitTorrent%20on%20Docker%20Swarm%20%28Part%201%29%20-%20https%3a%2f%2fveerendra2.github.io%2fwireguard-qbittorrent-docker-swarm-1%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Wireguard VPN and BitTorrent on Docker Swarm (Part 1) on telegram" href="https://telegram.me/share/url?text=Wireguard%20VPN%20and%20BitTorrent%20on%20Docker%20Swarm%20%28Part%201%29&url=https%3a%2f%2fveerendra2.github.io%2fwireguard-qbittorrent-docker-swarm-1%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><script src=https://giscus.app/client.js data-repo=veerendra2/veerendra2.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkxMTU4MjE4OTE=" data-category=General data-category-id=MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyODQwMzM5 data-mapping=url data-reactions-enabled=0 data-theme=dark_tritanopia crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the comments powered by giscus.</noscript></article></main><footer class=footer><span>&copy; 2023 <a href=https://veerendra2.github.io>Veerendra's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>